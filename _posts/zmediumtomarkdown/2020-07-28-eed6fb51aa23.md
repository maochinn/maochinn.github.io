---
title: "【筆記】Context Capture"
author: "帽捲"
date: 2020-07-28T09:24:18.155+0000
last_modified_at: 2020-09-07T02:42:32.344+0000
categories: ["Maochinn"]
tags: ["computer-graphics"]
description: "這篇主要就是用Context Capture(以下簡稱CC)來跑一個重建，首先要有一組照片，然後把照片輸入給CC，我猜測CC裡面應該是做Structure from Motion(SfM)，因為它沒有使用到深度資訊，而中間也利用找特徵點的方式下找。"
image:
  path: /assets/eed6fb51aa23/1*DQqUP3KuVEDN3a89MtZn0g.png
render_with_liquid: false
---

### 【筆記】Context Capture

這篇主要就是用Context Capture\(以下簡稱CC\)來跑一個重建，首先要有一組照片，然後把照片輸入給CC，我猜測CC裡面應該是做Structure from Motion\(SfM\)，因為它沒有使用到深度資訊，而中間也利用找特徵點的方式下找，所以如果特徵不足就會重建的很差，而特徵很像，那很容易找出有問題Match也會造成重建的很差。

首先先用Blender 2\.83來產生一連串的照片來當作data，這邊使用OpenCV的AR marker來增加特徵點，將想要重建的樹放在中間。


![](/assets/eed6fb51aa23/1*DQqUP3KuVEDN3a89MtZn0g.png)


樹是利用Blender的addon Sapling產生的，用將近100個相機來環繞拍攝，可以產生近100張照片，然後丟進CC重建。


![](/assets/eed6fb51aa23/1*_9HV_hpvJnr7QkyCh8jjhg.png)


這邊提供render的腳本，按右邊的撥放鍵就可以執行腳本，這個可以利用場景中的Circle來產生一串Camera，Camera的方向會指向世界座標的原點。


![](/assets/eed6fb51aa23/1*szVEPmIx9Tq3Kco1ezUv0g.png)



![](/assets/eed6fb51aa23/1*X4_bHTukdRD8dg4gxAOW5g.png)


另外也提供render的腳本，它會用場景中所有的camera來render到\.blend檔那個目錄的Tree資料夾內。


![](/assets/eed6fb51aa23/1*nPJz6KUof1z3lo-3OKyZnA.png)


接下來就是把照片都丟到CC重建，這邊就不一步一步來。


![](/assets/eed6fb51aa23/1*4uwKrWl98BXKRRB0qnIlWQ.png)


重建完可以得到可以進到3D view來看結果，這邊會顯示所有的特徵點在3D空建的位置，也可以點選任一個相機，在右側會顯示對應到的照片以及位置、姿態等資訊。


![](/assets/eed6fb51aa23/1*Aqa-GSAu-La0zlh0dar9aA.png)


這邊可以Export to XML，XML可以看到每個照片的相關資訊。

這邊也提供腳本CC\_XML\_import可以把檔案讀進來，Camera的名子就對應到那張圖的名子，如果要完整路徑可以直接把imagePath當成名子，但是可能造成名子太長導致部分字元消失。


![](/assets/eed6fb51aa23/1*0pG3nw4Z-HfodhXw6tPulw.png)


執行之後，右邊有兩個選項

load image，依據\.xml給的image 路徑將圖片載入，然後放到camera裡面\(注意圖片的位置應該跟CC重建的時候一樣，這樣\.xml的圖片路徑才能load到\)。

pack image，將load進來的image pack到\.blend之中。


![](/assets/eed6fb51aa23/1*kUSIFJYKNqS9DcaLJ3Nm3w.png)



![](/assets/eed6fb51aa23/1*1CNv_qrXbH58ZXcywfAmJg.png)



![left\)no load image, right\)load image](/assets/eed6fb51aa23/1*QU9Tok5ZGzpQSsxIBnon9g.png)

left\)no load image, right\)load image

可以切到shading，調整mix shader的值可以調整圖片的透明度。


![](/assets/eed6fb51aa23/1*Yl72YBi8wkW71KDCdX6HJw.png)



![](/assets/eed6fb51aa23/1*tDwH4VMjepE7BnHhau7qtw.png)


這邊的圖是另一組圖，示意用。

在CC這邊可以打開Automatic tie points navigator，可以看一些資訊。


![](/assets/eed6fb51aa23/1*yCjWDEgKEzQxMZl9RmTl8g.png)



![](/assets/eed6fb51aa23/1*zEkvaFCmyy1r-2A2R9xGNg.png)


這邊可以點每個特徵點，然後可以在上方看到那個特徵點的位置，右邊則是它會在那些照片出現以及對應到的位置和相關資訊。這個部分暫時沒找到怎麼輸出。

然後用這些資訊再輸出成OBJ。


![](/assets/eed6fb51aa23/1*xAwYneNqE4uEphg_VJSjXA.png)

#### Source Code


[![](https://opengraph.githubassets.com/9846c5671bd3f8c50ef0d000cae6064b89799680c6e69e5e4591ef8fb3686437/maochinn/CC_Blender_reconstruction)](https://github.com/maochinn/CC_Blender_reconstruction){:target="_blank"}


裡面有\.blend，原則上用2\.8以上的blender應該就可以開了，裡面就有上面提到的三個腳本，另外Tree資料夾附有render完的照片以及CC重建完的資訊\( \.xml\)，和重建的模型\( \.obj\)。



_[Post](https://medium.com/maochinn/%E7%AD%86%E8%A8%98-context-capture-eed6fb51aa23){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
