---
title: "FLTK Project Roller Coasters"
author: "帽捲"
date: 2020-07-16T11:49:59.741+0000
last_modified_at: 2022-12-22T05:28:25.931+0000
categories: ["Maochinn"]
tags: ["computer-graphics"]
description: "Project頁面:Trains and Roller Coasters(附有範例執行檔)"
image:
  path: /assets/f488c70dd7e9/1*NfB4LkjQ0PMYQhzuWsid-g.png
render_with_liquid: false
---

### FLTK Project Roller Coasters

Project頁面: [Trains and Roller Coasters](http://dgmm.csie.ntust.edu.tw/?ac1=courprojdetail_CG2012F_3&id=5ecf904f6bb6a&sid=5ecf9052f3138){:target="_blank"} \(附有範例執行檔\)


[![](https://opengraph.githubassets.com/80fed528f38013ffce843064ffa8bb10cf3617d6ac9f61a51b383f71163bc1f0/maochinn/RollerCoasters)](https://github.com/maochinn/RollerCoasters){:target="_blank"}


這邊提供兩種FLTK skeleton:

[Basic Version](http://dgmm.csie.ntust.edu.tw/?uid=5f0e7ed4208b7){:target="_blank"} ，提供基本的功能，包含旋轉畫面、選取移動控制點。

[GLAD Version](http://dgmm.csie.ntust.edu.tw/?uid=5f0e7fb30db2b){:target="_blank"} ，內含glad，可以使用opengl2\.x之後的語法。

這邊也歡迎使用其它自己的framework，例如:glfw\+nanogui。


![](/assets/f488c70dd7e9/1*NfB4LkjQ0PMYQhzuWsid-g.png)


Skeleton會提供基本的shading，所有GL都是基於1\.x版本的，所以建議要先理解 [電腦圖學\-Shading](../515575499065/) ，而GLAD版本的skeleton就是可以使用2\.x版本以上的語法，當然前提是你的顯卡支援。可以稍微提一下，網路上蠻多都會使用glew，原則上glad可以取代掉glew而且比較新也不用編lib。

這個Project有三個核心目標
#### GL Rendering

除了使用GL的shading，也要理解GL的Pipeline跟其他基本設定，例如depth testing, clipping, culling，當然lighting的相關設定也要熟悉。
#### Transformation

原則上在 [FLTK Project Maze](../338c2109989d/) 就要有一定程度上的理解了，但這個Project要做出更多更複雜的變換，所以需要有清晰的認識才有辦法完成。
#### Parametric Polynomial Curves

利用數個控制點來決定一條曲線，在Project有規定要完成三種:Linear, Cardinal Cubic and Cubic B\-Spline Curve。

利用多項式來產生曲線，例如非常常見的貝茲曲線\(Bezier curve\)。


![Bezier curve and Linear curve](/assets/f488c70dd7e9/0*f7AoSVM1QkclpEhe.gif)

Bezier curve and Linear curve

就如上圖所示，我們只需要定義4個controal point\(控制點\)，就可以決定其中的曲線，那你也可以想像，這其中有無限種方式來決定中間的曲線，當然這也包含直接把4個點照順序連起來，而這就是Linear Curve，其實你也可以看成是Linear interpolation，因為2點之間的點就只用前後2個點來決定，所以如果寫成多項式就會是\(linear polynomial\)線性多項式。


![圖中\(t\-1\)應改為\(1\-t\)](/assets/f488c70dd7e9/0*Equ89zfe0liZcgzV.png)

圖中\(t\-1\)應改為\(1\-t\)

那接下來就可以猜到，如果曲線中的一個點與3點相關，那他的多項式就會變成二次多項式\(quadratic polynomial\)，那與4點相關就是三次多項式\(cubic polynomial\)，所以現在也就可以猜到Cardinal Cubic and Cubic B\-Spline Curve的Cubic的意思了。


![](/assets/f488c70dd7e9/0*8_FpP2ZYAumuoRnD.png)


以上圖舉例，P\(1, 0\)表示第0次項\(也就是原始的控制點\)中的第1個點，P\(0, 1\)表示第1次項中的第0個點，上圖中的曲線很明顯的是用到三次項，也就是cubic spline，也就是曲線上的每個點需要考慮前後4個點來決定，以上圖為例我要曲線中的中心點，所以我們就設定參數t = 0\.5\(起點t=0，終點t=1\)，就是先用4個控制點利用內插求出3個1次點\(t=0\.5表示求中間點\)，在用內插求2個2次點\(一樣是中間點\)，最後就可以用內插求出1個3次點，而這個點就是所求。


![](/assets/f488c70dd7e9/0*6AFvYSQp3tISHo5T)



![[https://people\.eecs\.berkeley\.edu/~sequin/CS184/GuestLecture\_05/SplineLect1\.html](https://people.eecs.berkeley.edu/~sequin/CS184/GuestLecture_05/SplineLect1.html){:target="_blank"}](/assets/f488c70dd7e9/0*mbGjoE0Qki5onDYc.gif)

[https://people\.eecs\.berkeley\.edu/~sequin/CS184/GuestLecture\_05/SplineLect1\.html](https://people.eecs.berkeley.edu/~sequin/CS184/GuestLecture_05/SplineLect1.html){:target="_blank"}

經過簡化之後，我們可以把曲線上的某個點畫成一個與t有關的多次多項式，那我們就以cubic spline舉例，我們可以把它畫成矩陣、向量的形式。


![](/assets/f488c70dd7e9/0*8Nc87ztjwury8cQz)



![](/assets/f488c70dd7e9/0*5wwgOPuyrsCDiWVO)


總之，就是可以畫成三個矩陣相乘的形式，T就表示parameter matrix，C就是coeffcient matrix，其中C可以拆成M, G，M表示basis matrix，G表示geometric constraints matrix，也就是4個控制點。而事實上，各種cubic spline的差別就是中間的M矩陣的差別。

通常GL我們會把向量都立起來，所以整個運算會變成這樣。


![](/assets/f488c70dd7e9/1*99kMc_pacaTcoDSOp6iVWw.png)



![Cardinal](/assets/f488c70dd7e9/1*P1M6oSwqzwjzv_BegYBRyg.png)

Cardinal


![B\-Spline](/assets/f488c70dd7e9/1*8otSlBtCtQRxDcKf52QfnA.png)

B\-Spline

因為spline的座標都是parameter t的函數，所以我們可以把它看成這個spline是定義在參數空間\(parameter space\)但是我們看到的spline通常是在幾何空間\(geometry space\)，所以這會出現兩種continuity\(連續性\)，geometric continuity跟parametric continuity，先來解釋一下甚麼叫做continuity，簡單來說，如果有5個控制點，那用cubic spline，那就會有兩條spline，那這兩條spline的joint\(連接點\)如果沒有連在一起，那它就沒有連續性，也就是spline的終點到下一條spline的起點的會影響連續性。
#### Geometric continuity


![](/assets/f488c70dd7e9/0*Tac2-WILe0oCgrUt.jpg)


只有joint的幾何位置相同，那就是有0階的連續性\(G0\)，那如果joint在幾何上的tangent\(斜率\)也相同那就有1階的連續性\(G1\)，如果curvature\(曲率\)相同就有G2，比較敏感的人應該會發現這其實G1的1就是對應到1階微分的概念而原則上連續性越高就會越平滑。
#### Parametric continuity

那前面可以看到我們是在幾何空間看連續性，而在參數空間也可以看連續性，同樣的也是有C0, C1, C2…。


![](/assets/f488c70dd7e9/0*jG06t2Z-k0EkEu7E.png)


G0跟C0是等價的，但是G1跟C1就不是等價的，比較直觀的解釋是G1只需要joint的斜率相同，也就是方向相同就好，可是C1則是速度相同，也就是除了方向相同，量值也必須相同，所以常常如果是C1就會是G1，但是這邊要注意還是有特例。


![](/assets/f488c70dd7e9/0*OU89be-3SotLhMYq.JPG)


總之這個就是名詞解釋，各種spline其實就可以查到他們的連續性是怎麼樣。

另外，因為曲線定義在t參數空間，而不是幾何空間，所以參數空間的距離跟幾何空間的距離並沒有直接關係，舉例來說t=0\.1~0\.2與t=0\.8~0\.9在參數空間的長度都是0\.1，但是經過計算之後的在曲線上的幾何長度是不同的，而不同的曲線更會差的更多，舉例來說一條曲線的幾何長度\(arc length\(弧長\) \)為10和另一條arc length為100這兩者在參數空間的長度是相同的，都是從0~1，但是幾何長度卻差很多，可以想像成前者有10來分布10個點，但後者有100來分布10個點，後者點和點之間的間距明顯會較大。


![[https://patents\.google\.com/patent/JP4131993B2/en](https://patents.google.com/patent/JP4131993B2/en){:target="_blank"}](/assets/f488c70dd7e9/0*ORlixB_Kx0Gc-6HE.png)

[https://patents\.google\.com/patent/JP4131993B2/en](https://patents.google.com/patent/JP4131993B2/en){:target="_blank"}

但我們希望能夠在幾何空間上控制，例如我們希望能夠每段間距相同，而這會造成參數空間上的間距變的不同，而我們需要利用重新參數化來做到這件事。

如果想知道比較完整的可以參考這個影片，講的非常完整


[![The Continuity of Splines](/assets/f488c70dd7e9/7336_hqdefault.jpg "The Continuity of Splines")](https://www.youtube.com/watch?v=jvPPXbo87ds){:target="_blank"}

#### Arc\-length parameterization

首先必須要知道每一段曲線的arc length，然後依據每段arc length來normalize。

簡單來說就是我們要將本來以t定義的曲線函數改成以弧長s定義的曲線函數，而這個弧長就是定義在幾何空間的，換句話說就是讓Q\(t\)的曲線函數轉換成Q\(s\)的函數，這也代表我們要計算弧長。


![](/assets/f488c70dd7e9/0*FJhmYYnsYFpri-JI)


計算弧長比較容易的方式就是直接把曲線分段，只要分的越細就就越接近原始曲線，那當然算出來的弧長就越接近正確的弧長。只要我們能把t跟s對應的表記起來我們就能直接用內插的方式找到任意s對應到的t。
#### Refenrence

[**Building cubic B\-spline**](https://www.ibiblio.org/e-notes/Splines/B-spline.htm){:target="_blank"} 
[_Earlier we built C1 continuous Cardinal spline\. Now we will make a piecewise C2 continuous uniform B\-spline of two…_ www\.ibiblio\.org](https://www.ibiblio.org/e-notes/Splines/B-spline.htm){:target="_blank"}

[**CS184 Spline Guest lecture \#1**](https://people.eecs.berkeley.edu/~sequin/CS184/GuestLecture_05/SplineLect1.html){:target="_blank"} 
[_Even 200 years ago engineers used smooth shapes: \- \- in ship building for fast, smooth hulls, \- \- in watch making for the…_ people\.eecs\.berkeley\.edu](https://people.eecs.berkeley.edu/~sequin/CS184/GuestLecture_05/SplineLect1.html){:target="_blank"}

[**CompSci 344 : Spring 2015**](https://www2.cs.duke.edu/courses/compsci344/spring15/classwork/12_curves/){:target="_blank"} 
[_Sampling Theory An animation can be viewed as a function over time How to represent compactly and completely?_ www2\.cs\.duke\.edu](https://www2.cs.duke.edu/courses/compsci344/spring15/classwork/12_curves/){:target="_blank"}

[https://homepages\.inf\.ed\.ac\.uk/rbf/CVonline/LOCAL\_COPIES/AV0405/DONAVANIK/bezier\.html](https://homepages.inf.ed.ac.uk/rbf/CVonline/LOCAL_COPIES/AV0405/DONAVANIK/bezier.html){:target="_blank"}

[http://web\.cs\.wpi\.edu/~matt/courses/cs563/talks/surface/bez\_surf\.html](http://web.cs.wpi.edu/~matt/courses/cs563/talks/surface/bez_surf.html){:target="_blank"}



_[Post](https://medium.com/maochinn/fltk-project-roller-coasters-f488c70dd7e9){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
