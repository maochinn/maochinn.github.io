---
title: "【Omniverse】學習筆記 — 02：Kit Workshop SIGGRAPH 2022"
author: "帽捲"
date: 2024-10-11T06:13:54.049+0000
last_modified_at: 2025-02-27T07:15:21.641+0000
categories: ["Maochinn"]
tags: ["omniverse","nvidia","siggraph","extension","101"]
description: "本篇延續【Omniverse】學習筆記 — 00：Kit-based Development跟著Learning Path繼續學習剩下的Course，分別是"
image:
  path: /assets/2183284ed751/0*kG7encqWuok540AH.png
render_with_liquid: false
---

### 【Omniverse】學習筆記 — 02：Kit Workshop SIGGRAPH 2022

English Version: [【Omniverse】Development 101: Kit Workshop SIGGRAPH 2022](https://medium.com/@maochinn/omniverse-development-101-kit-workshop-siggraph-2022-310a189add0b?source=your_stories_page-------------------------------------){:target="_blank"}

本篇延續 [【Omniverse】學習筆記 — 00：Kit\-based Development](https://medium.com/maochinn/omniverse-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98-00-kit-based-development-a54ae65f22bf?source=your_stories_page-------------------------------------){:target="_blank"} 跟著Learning Path繼續學習剩下的Course
#### 目錄
- Build Beautiful, Custom UI for 3D Tools on NVIDIA Omniverse
- Easily Develop Advanced 3D Layout Tools on NVIDIA Omniverse
- How to Build Custom 3D Scene Manipulator Tools on NVIDIA Omniverse



![Figure 1: Omniverse Kit\-based Development Learning Path](/assets/2183284ed751/1*96JSVd1mtkEXLgmIJ4ecSg.png)

Figure 1: Omniverse Kit\-based Development Learning Path

值得提醒的是，這三個course都是基於Omniverse Laucher中的Omniverse Code，這個之前在 [【Omniverse】學習筆記 — 00：Kit\-based Development](https://medium.com/maochinn/omniverse-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98-00-kit-based-development-a54ae65f22bf?source=your_stories_page-------------------------------------){:target="_blank"} 提過可以使用Kit Base Editor取代，也就是可以利用kit\-app\-template創建出來。

另外，這3個Course還有一個共通點，他們似乎都是來自於SIGGRAPH 2022的Workshop，因此他們的課程中使用的版本才會停留在比較舊的時候，導致可能有些課程中使用到的extension已經找不到了，幸運的是，我們可以在NVIDIA的Github上找到他們。

[**kit\-workshop\-siggraph2022/exts at v1\.0\.1 · NVIDIA\-Omniverse/kit\-workshop\-siggraph2022**](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts){:target="_blank"} 
[_SIGGRAPH 2022 Workshop\. Contribute to NVIDIA\-Omniverse/kit\-workshop\-siggraph2022 development by creating an account on…_ github\.com](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts){:target="_blank"}

要留意的是Course中用的tag是v1\.0\.1，裏頭總共有5個extensions，可以依照自己的需求添加到自己的application，這裡面就包含了在 [【Omniverse】學習筆記 — 00：Kit\-based Development](https://medium.com/maochinn/omniverse-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98-00-kit-based-development-a54ae65f22bf?source=your_stories_page-------------------------------------){:target="_blank"} 中自己做的scatter extension，至於如何添加extension到自己的application方法在 [【Omniverse】學習筆記 — 01：Application and Extension](https://medium.com/maochinn/omniverse-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98-01-application-and-extension-e765192086c8?source=your_stories_page-------------------------------------){:target="_blank"} 都有說明了。
### Build Beautiful, Custom UI for 3D Tools on NVIDIA Omniverse

簡單來說，這個course就是基於Scatter這個Extension去增加一些Custom UI以及功能。

[**Course \| NVIDIA**](https://learn.nvidia.com/courses/course?course_id=course-v1:DLI+S-OV-08+V1&unit=block-v1:DLI+S-OV-08+V1+type@vertical+block@d5674416bd004c8fae8b0bd2fd7249f5){:target="_blank"} 
[_Edit description_ learn\.nvidia\.com](https://learn.nvidia.com/courses/course?course_id=course-v1:DLI+S-OV-08+V1&unit=block-v1:DLI+S-OV-08+V1+type@vertical+block@d5674416bd004c8fae8b0bd2fd7249f5){:target="_blank"}

需要注意的是，如果你是用自己做的extension的話，需要做一些調整，例如，按鈕的click call backfuction要因為要帶入參數進去，所以要多用一層匿名函式包著，所以要改這個函式
```python
ui.Button(
                        " S ",
                        width=0,
                        height=0,
                        style={"margin": 0},
                        clicked_fn=self._on_get_selection,
                        tooltip="Get From Selection",
                    )
```

其中， _clicked\_fn_ 要改成這樣
```python
clicked_fn=lambda:self._on_get_selection(self._source_prim_model),
```

另外， _\_on\_get\_selection_ 則要改成
```python
def _on_get_selection(self, model):
        """Called when tthe user presses the "Get From Selection" button"""
        model.as_string = ", ".join(get_selection())
```

另一個按鈕也是相同的道理，要改成這樣
```python
ui.Button("Scatter", clicked_fn=lambda:self._on_scatter(self._source_prim_model, self._scatter_prim_model))
```

以及方法要改成吃兩個參數
```python
def _on_scatter(self, source_model, scatter_model):
        """Called when the user presses the "Scatter" button"""
        prim_names = [i.strip() for i in source_model.as_string.split(",")]
        if not prim_names:
            prim_names = get_selection()

if not prim_names:
            # TODO: "Can't clone" message
            pass

transforms = scatter(
            count=[m.as_int for m in self._scatter_count_models],
            distance=[m.as_float for m in self._scatter_distance_models],
            randomization=[m.as_float for m in self._scatter_random_models],
            id_count=len(prim_names),
            seed=self._scatter_seed_model.as_int,
        )

duplicate_prims(
            transforms=transforms,
            prim_names=prim_names,
            target_path=scatter_model.as_string,
            mode=self._scatter_type_model.get_current_item().as_string,
        )
```

或者就是直接添加現成的extension


![Figure 2: Scatter Tool \(omni\.example\.ui\_scatter\_tool\)](/assets/2183284ed751/0*Etk-7IE3e_qQX-_m.png)

Figure 2: Scatter Tool \(omni\.example\.ui\_scatter\_tool\)

[**kit\-workshop\-siggraph2022/exts/omni\.example\.ui\_scatter\_tool at v1\.0\.1 ·…**](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts/omni.example.ui_scatter_tool){:target="_blank"} 
[_SIGGRAPH 2022 Workshop\. Contribute to NVIDIA\-Omniverse/kit\-workshop\-siggraph2022 development by creating an account on…_ github\.com](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts/omni.example.ui_scatter_tool){:target="_blank"}


[![](https://opengraph.githubassets.com/6bb422c307af8ebb2dfd1459287711f2c82a3170eb107b415ebd5ed175dd4712/NVIDIA-Omniverse/kit-extension-sample-scatter)](https://github.com/NVIDIA-Omniverse/kit-extension-sample-scatter){:target="_blank"}


Course最後提到的omni\.kit\.window\.inspector這個extension目前我找不到，似乎可以用它來直接在畫面上調整UI，可以先看preview不會影響到code，但是似乎也是過期了，或是換了名子，總之我找不到。
### Easily Develop Advanced 3D Layout Tools on NVIDIA Omniverse

繼續基於Scatter這個Extension修改，比較重要的是，修改的部分有牽涉到transformation，因此這邊稍微紀錄一下重要的東西。

[**Course Detail \| NVIDIA**](https://learn.nvidia.com/courses/course-detail?course_id=course-v1:DLI+S-OV-07+V1){:target="_blank"} 
[_About Course Objectives Topics Covered Course Outline Stay Informed Contact Us_ learn\.nvidia\.com](https://learn.nvidia.com/courses/course-detail?course_id=course-v1:DLI+S-OV-07+V1){:target="_blank"}

首先，在pxr中有一個Gf\(Graphics Foundations\)，其中有一些矩陣計算之類的工具。
```python
from pxr import Gf
```

其中，pxr就是pixar，Gf的matrix是row\-major order，應該是因為\.usd裏面的matrix是row\-major的，而Omniverse是基於pixar推出的\.usd檔案格式所建立的。

[**Gf module — pxr\-usd\-api 105\.0\.2 documentation**](https://docs.omniverse.nvidia.com/kit/docs/pxr-usd-api/105.0.2/pxr/Gf.html#pxr.Gf.Matrix4d){:target="_blank"} 
[_The transformation matrix is applied as follows: the position and the direction vector are transformed with the given…_ docs\.omniverse\.nvidia\.com](https://docs.omniverse.nvidia.com/kit/docs/pxr-usd-api/105.0.2/pxr/Gf.html#pxr.Gf.Matrix4d){:target="_blank"}

但是要注意，OpenUSD的矩陣乘法是pre\-multiplication\(前乘\)，向量會在矩陣的左側，向量則是row vector，我們戲稱是躺著的vector。相對來說，OpenGL則是post\-multiplication\(後乘\)，向量是在矩陣右側，是colume vector。

因此，OpenUSD的矩陣相乘的順序會跟OpenGL相反，舉例來說就是Scale\*Rotate\*Translate，向量會在左側，矩陣會往右乘
```python
transformation = (
    Gf.Matrix4d().SetScale(
        Gf.Vec3d(
            1.0,
            1.0,
            1.0,
        ))
    * Gf.Matrix4d().SetTranslate(
        Gf.Vec3d(
            0.0,
            0.0,
            0.0,
        ))
)
```

因此，可以透過Translation的這三種拿法注意到，transformation matrix中的translation vector是在最後一個row，也就是矩陣中最底下的那一排。
```python
matrix= Gf.Matrix4d(1)

matrix.ExtractTranslation()
matrix.GetRow(3)
matrix[3]
```

這邊也就可以知道matrix\[i\] \[j\]是指第i個row，第j個col，其中translate就會放在最下面的那個row。另外補充一點，不知道為甚麼scale沒有開API，似乎只能這樣去拿
```python
matrix= Gf.Matrix4d(1)

scale_vector = (matrix.GetRow3(0).GetLength(), matrix.GetRow3(1).GetLength(), matrix.GetRow3(2).GetLength())
```

這邊有個點要注意的是，矩陣的運算分為pre\-multiplication，post\-multiplication，同時矩陣的表示分為row\-major和column\-major，如果光看單一矩陣常常會搞混，例如pre\-multiplication、row\-major的矩陣如果按照順序print出來會發現translation vector是底下最後一排，但是post\-multiplication、column\-major的矩陣print也會發現一樣的事情，但是兩者大不相同，前者print出來的最後一排是row，後者print出來的最後一排是col。

總之，只要矩陣是pre\-multiplication，那麼translation vector就是row vector，post\-multiplication的矩陣中的translation vector就是column vector，只是怎麼儲存matrix又區分成row\-major和column\-major。


[![](https://opengraph.githubassets.com/fc53e3ee365ef932aae86da74a37a34e8a5853e72c4bd7e36ab52c92e7db781f/Vochsel/vochsel_wiki)](https://github.com/Vochsel/vochsel_wiki/blob/master/usd.md){:target="_blank"}


[**Universal Scene Description: GfMatrix4d Class Reference**](https://openusd.org/dev/api/class_gf_matrix4d.html){:target="_blank"} 
[_Accesses an indexed row i of the matrix as an array of 4 double values so that standard indexing \(such as m\[0\] \[1\] \)…_ openusd\.org](https://openusd.org/dev/api/class_gf_matrix4d.html){:target="_blank"}

[**Universal Scene Description: UsdGeom : USD Geometry Schema**](https://openusd.org/release/api/usd_geom_page_front.html#UsdGeom_LinAlgBasics){:target="_blank"} 
[_UsdGeom defines the 3D graphics\-related prim and property schemas that together form a basis for interchanging geometry…_ openusd\.org](https://openusd.org/release/api/usd_geom_page_front.html#UsdGeom_LinAlgBasics){:target="_blank"}
### How to Build Custom 3D Scene Manipulator Tools on NVIDIA Omniverse

Course為兩個階段，但基本上只算是火力展示，實際上的操作不多，主要是告訴你extension可以做到甚麼事情，讓你自己可以基於這些extension再去開發自己的extension。

[**Course Detail \| NVIDIA**](https://learn.nvidia.com/courses/course-detail?course_id=course-v1:DLI+S-OV-06+V1){:target="_blank"} 
[_About Course Objectives Topics Covered Course Outline Stay Informed Contact Us_ learn\.nvidia\.com](https://learn.nvidia.com/courses/course-detail?course_id=course-v1:DLI+S-OV-06+V1){:target="_blank"}

首先是Widget Info，可以在3D物件旁邊以screen space的方式顯是物件的資訊，可以從這邊自己添加extension


![Figure 3: Widget Info \(omni\.example\.ui\_scene\.widget\_info\)](/assets/2183284ed751/0*pfv5IlXAIPSPTFYQ.png)

Figure 3: Widget Info \(omni\.example\.ui\_scene\.widget\_info\)

[**kit\-workshop\-siggraph2022/exts/omni\.example\.ui\_scene\.widget\_info at v1\.0\.1 ·…**](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts/omni.example.ui_scene.widget_info){:target="_blank"} 
[_SIGGRAPH 2022 Workshop\. Contribute to NVIDIA\-Omniverse/kit\-workshop\-siggraph2022 development by creating an account on…_ github\.com](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts/omni.example.ui_scene.widget_info){:target="_blank"}

只是要注意的是，可能是版本的關係，有些API已經過時了，因此要去改widget\_info\_model\.py中的UsdLux\.Light改成UsdLux\.RectLight，不然會無法添加導致報錯，雖然程式碼意思不太一樣，但是至少能跑起來


![Figure 4: Compare with old and modified version](/assets/2183284ed751/1*aGEZhFK_O_EGA9D3oqIZMA.png)

Figure 4: Compare with old and modified version

第二個部分是Light Manipulator，可以在viewport中直接調整Rectlight\(平面光光源\)的範圍以及亮度/強度，一樣可以自己安裝


![Figure 5: Light Manipulator \(omni\.example\.ui\_scene\.light\_manipulator\)](/assets/2183284ed751/0*kG7encqWuok540AH.png)

Figure 5: Light Manipulator \(omni\.example\.ui\_scene\.light\_manipulator\)

[**kit\-workshop\-siggraph2022/exts/omni\.example\.ui\_scene\.light\_manipulator at v1\.0\.1 ·…**](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts/omni.example.ui_scene.light_manipulator){:target="_blank"} 
[_SIGGRAPH 2022 Workshop\. Contribute to NVIDIA\-Omniverse/kit\-workshop\-siggraph2022 development by creating an account on…_ github\.com](https://github.com/NVIDIA-Omniverse/kit-workshop-siggraph2022/tree/v1.0.1/exts/omni.example.ui_scene.light_manipulator){:target="_blank"}

這個部分也有些東西要調整，要在extension\.py中添加 _super\( \) \. \_ \_init\_ \_ \( \)_ ，否則會一樣會報錯


![Figure 6](/assets/2183284ed751/1*H8OVrL3tibOS9__FbK_GBw.png)

Figure 6

但是這邊要注意如果你是用Course附的stage\.usd的話，場景中的rectlight不會顯示如Figure 4中的黃色線條，但是如果自己手動create新的rectlight則會正常顯示。

事實上，這並不是程式碼或是API的問題，應該是\.usd的格式改變，或是omniverse讀取\.usd的規則改變，因為如果我們將兩個Rectlight一起輸出成\.usda，打開兩相比較就會知道為什麼

這邊我就直接講該如何調整，場景本來的Rectlight如下
```java
        def RectLight "RectLight" (
            prepend apiSchemas = ["ShapingAPI"]
        )
        {
            color3f color = (0.19691122, 0.018246593, 0.15069367)
            float height = 232.31076
            float intensity = 24483.492
            float shaping:cone:angle = 180
            float shaping:cone:softness
            float shaping:focus
            color3f shaping:focusTint
            asset shaping:ies:file
            token visibility = "inherited"
            float width = 204.63292
            double3 xformOp:rotateXYZ = (-10.797770015817491, -160.58920866323336, 4.920241161909303)
            double3 xformOp:scale = (1, 1, 1)
            double3 xformOp:translate = (-5.962081968369314e-14, 150.00000000000003, -350.00000000000006)
            uniform token[] xformOpOrder = ["xformOp:translate", "xformOp:rotateXYZ", "xformOp:scale"]
        }
```

我們需要要在部分參數前面加上 _inputs:_
```java
def RectLight "RectLight" (
    prepend apiSchemas = ["ShapingAPI"]
)
{
    color3f color = (0.19691122, 0.018246593, 0.15069367)
    float inputs:height = 232.31076
    float inputs:intensity = 24483.492
    float inputs:shaping:cone:angle = 180
    float inputs:shaping:cone:softness
    float inputs:shaping:focus
    color3f shaping:focusTint
    asset shaping:ies:file
    token visibility = "inherited"
    float inputs:width = 204.63292
    double3 xformOp:rotateXYZ = (-10.797770015817491, -160.58920866323336, 4.920241161909303)
    double3 xformOp:scale = (1, 1, 1)
    double3 xformOp:translate = (-5.962081968369314e-14, 150.00000000000003, -350.00000000000006)
    uniform token[] xformOpOrder = ["xformOp:translate", "xformOp:rotateXYZ", "xformOp:scale"]
}
```

其中 _height、intensity、width_ ，這三個變數因為沒有加 _inputs:_ 導致腳本讀不到數值，當然也就算不出東西，也就造成extension不會顯示任何線條。

類似的extension在這邊也可以找到sample


[![](https://opengraph.githubassets.com/dc830dd893d0e51ae6f2f058fb333107c936e16aa48ccc41c585c261eff84342/NVIDIA-Omniverse/kit-extension-sample-ui-scene)](https://github.com/NVIDIA-Omniverse/kit-extension-sample-ui-scene/tree/main){:target="_blank"}


[**UsdLux module \- Omniverse Kit 106\.1\.0 documentation**](https://docs.omniverse.nvidia.com/kit/docs/pxr-usd-api/latest/pxr/UsdLux.html){:target="_blank"} 
[_Summary: The UsdLux module provides a representation for lights and related components that are common to many graphics…_ docs\.omniverse\.nvidia\.com](https://docs.omniverse.nvidia.com/kit/docs/pxr-usd-api/latest/pxr/UsdLux.html){:target="_blank"}
### 結論

可以透過這三個course大概知道extension實際上的可以怎麼應用，也可以利用NVIDIA現有的sample繼續學習，也可以從中發現，雖然部分程式碼過時導致需要調整部分程式碼，但是大部分的程式碼都仍然可行，我們也可以藉此自己試著debug。

只是有一點比較值得留意的是\.usd檔案，在不同的課程中都有提到，例如transformation跟在Attribute中添加 _inputs:_ 字段，似乎他們與Omniverse的關係十分密切，事實上，Omniverse正是基於USD所建立的，我們將在下一篇專注討論他們。


> The platform for developing OpenUSD applications for industrial digitalization and physical AI simulation\. 






[![](https://www.nvidia.com/content/dam/en-zz/Solutions/gtcf20/omniverse/refresh-open-beta/nvidia-omniverse-og-image-1200x630.jpg)](https://www.nvidia.com/en-us/omniverse/){:target="_blank"}


感謝你的閱讀，如果你對我的文章對你有所幫助或是意見歡迎回覆，如果你想要支持我可以：
- 拍個手👋，或是分享一些想法💬
- [追蹤我的頁面](https://medium.com/@maochinn){:target="_blank"}
- [訂閱我的專欄](https://medium.com/maochinn){:target="_blank"}
- [透過LinkedIn聯繫我](https://www.linkedin.com/in/chih-wei-chang-6526801b2/){:target="_blank"}


或是觀看我其他系列文章
- [【Omniverse】學習筆記 — 03：OpenUSD](../be14a4a5704f/)
- [【電腦圖學】學習筆記 — 00：OpenGL](../fa7105f59ecd/)
- [【Blender】Geometry Node 像素風](../1870e1ad5fc3/)
- [【Unity】Displacement Map](../f588242049c6/)



_[Post](https://medium.com/maochinn/omniverse-%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98-02-kit-workshop-siggraph-2022-2183284ed751){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
